<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Black Familie Kochbuch</title>
</head>
<body>
  <h1>Black Familie Kochbuch</h1>

  <input id="keyword" type="text" placeholder="Enter keyword..." />
  <button onclick="searchFiles()">Search</button>

  <h2>Results</h2>
  <ul id="results"></ul>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = "859780169804-foo7ue9l9ool6qn8onvtlokgl1uusm5h.apps.googleusercontent.com";
    const API_KEY = "AIzaSyC9LI_v1TGciLjP1BpxAO4eVwbybYkdWFE";
    const FOLDER_ID = "1ZU7JSlnWCo4jAk8K6s5GxV07QNB0jABj";
    const SCOPES = "https://www.googleapis.com/auth/drive.readonly";

    function loadGapi() {
      gapi.load("client:auth2", initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPES,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
      });
    }

    async function searchFiles() {
      const keyword = document.getElementById("keyword").value.trim();
      if (!keyword) return;

      // Ensure user is signed in
      if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
        await gapi.auth2.getAuthInstance().signIn();
      }

      const query = `'${FOLDER_ID}' in parents and fullText contains '${keyword}'`;
      const response = await gapi.client.drive.files.list({
        q: query,
        fields: "files(id, name, mimeType)"
      });

      const files = response.result.files;
      const resultsList = document.getElementById("results");
      resultsList.innerHTML = "";

      if (!files || files.length === 0) {
        resultsList.innerHTML = "<li>No results found.</li>";
        return;
      }

      files.forEach(file => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="https://drive.google.com/file/d/${file.id}/view" target="_blank">${file.name}</a>`;
        resultsList.appendChild(li);
      });
    }

    loadGapi();
  </script>
</body>
</html>
